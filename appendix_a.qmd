# Simulation Study Design

Here we present a rather short description following recommendations from previous research, but ideally even more may be reported [@pawel_etall_2025; @siepe_etall_2024; @morris_etall_2019; @white_etall_2024]. This mimics a methods or similar section in articles.

**Factorial Design.** The simulation employs a full factorial design with two factors: sample size ($n \in \{50, 100, 2000\}$) and degree of confounding non-linearity ($\gamma_2 \in \{0, 0.3, 0.8\}$, labeled as none, mild, and severe). The parameter $\gamma_2$ controls the strength of the quadratic confounder effect on the outcome (see Data Generation). This yields nine conditions, each replicated $K = 1000$ times.

**Data Generation.** For each replication, data are generated following a causal structure where a confounder $X_2$ affects both treatment assignment and the outcome. The confounder and treatment error term are generated using the {rvinecopulib} package: pairs $(U_1, U_2)$ are drawn from an independence copula via `rbicop()`, then transformed to standard normals via $X_2 = \Phi^{-1}(U_1)$ and $\epsilon = \Phi^{-1}(U_2)$. The independence copula is simply $C(u,v) = uv$, meaning the resulting uniforms are independentâ€”mathematically equivalent to calling `rnorm()` directly. We use {rvinecopulib} intentionally because it depends on C++ libraries.

Treatment assignment follows $X_1 = \alpha_0 + \alpha_1 X_2 + \alpha_2 X_2^2 + \epsilon$ where $\alpha_0 = 0$, $\alpha_1 = 0.5$, and $\alpha_2 = 0.2$. This creates confounding because $X_2$ influences treatment assignment through both linear and quadratic terms. The binary outcome is generated from the true logistic regression model:
$$
\text{logit}(P(Y = 1 \mid X_1, X_2)) = \beta_0 + \beta_1 X_1 + \gamma_1 X_2 + \gamma_2 X_2^2
$$

\noindent with parameters $\beta_0 = -0.5$, $\beta_1 = 0.7$ (the causal effect of interest), $\gamma_1 = -0.4$, and $\gamma_2$ varying by condition. The analyst misspecifies the outcome model by omitting the quadratic confounder term, fitting instead:
$$
\text{logit}(P(Y = 1 \mid X_1, X_2)) = \beta_0 + \beta_1 X_1 + \gamma_1 X_2
$$

This misspecification creates residual confounding because the omitted term $\gamma_2 X_2^2$ is correlated with $X_1$ (since $X_1$ depends on both $X_2$ and $X_2^2$), violating the conditional exchangeability assumption given linear adjustment alone.

**Estimand.** The target estimand is the average causal effect (ACE) of $X_1$ on $Y$, properly adjusted for confounding:
$$
\text{ACE}(X_1) = \mathbb{E}\left[\frac{\partial P(Y = 1 \mid X_1, X_2)}{\partial X_1}\right] = \mathbb{E}\left[\beta_1 \cdot \frac{\exp(\eta)}{(1 + \exp(\eta))^2}\right]
$$

\noindent where $\eta = \beta_0 + \beta_1 X_1 + \gamma_1 X_2 + \gamma_2 X_2^2$ is the correctly specified linear predictor, and the expectation is taken over the joint distribution of $(X_1, X_2)$. For each $\gamma_2$ condition, the "true" ACE (denoted $\theta$) is approximated once using a very large sample ($N = 200,000$) with the correctly specified model including $X_2^2$. 

**Estimator.** The causal effect is estimated from the misspecified model (omitting $X_2^2$) as:
$$
\widehat{\text{ACE}}(X_1) = \frac{1}{n}\sum_{i=1}^{n} \tilde{\beta}_1 \cdot \frac{\exp(\tilde{\eta}_i)}{(1 + \exp(\tilde{\eta}_i))^2}
$$

\noindent where $\tilde{\eta}_i = \tilde{\beta}_0 + \tilde{\beta}_1 X_{i1} + \tilde{\gamma}_1 X_{i2}$ and $\tilde{\boldsymbol{\beta}} = (\tilde{\beta}_0, \tilde{\beta}_1, \tilde{\gamma}_1)$ are maximum likelihood estimates from the misspecified logistic regression. 

| Criterion | Estimate | MCSE |
|:--|:--|:--|
| Bias | $\frac{1}{K}\sum_{k=1}^K \hat{\theta}_k - \theta$ | $\sqrt{\frac{1}{K(K-1)}\sum_{k=1}^K(\hat{\theta}_k - \bar{\hat{\theta}})^2}$ |
| Variance | $\frac{1}{K-1}\sum_{k=1}^K(\hat{\theta}_k - \bar{\hat{\theta}})^2$ | $\sqrt{\frac{K-1}{K}}\cdot\frac{1}{K-1}\sum_{k=1}^K(\hat{\theta}_k - \bar{\hat{\theta}})^2$ |
| RMSE | $\sqrt{\frac{1}{K}\sum_{k=1}^K (\hat{\theta}_k - \theta)^2}$ | $\sqrt{\frac{K-1}{K}\sum_{j=1}^K\left(\sqrt{(\hat{\theta}_j - \theta)^2} - \overline{RMSE}\right)^2}$ |
| Relative Bias | $\frac{1}{\theta K}\sum_{k=1}^K \hat{\theta}_k$ | $\frac{1}{\theta}\sqrt{\frac{1}{K(K-1)}\sum_{k=1}^K(\hat{\theta}_k - \bar{\hat{\theta}})^2}$ |
| Relative RMSE | $\frac{1}{\theta}\sqrt{\frac{1}{K}\sum_{k=1}^K (\hat{\theta}_k - \theta)^2}$ | $\frac{1}{\theta}\sqrt{\frac{K-1}{K}\sum_{j=1}^K\left(\sqrt{(\hat{\theta}_j - \theta)^2} - \overline{RMSE}\right)^2}$ |
| Coverage | $\frac{1}{K}\sum_{k=1}^K I(A_k \leq \theta \leq B_k)$ | $\sqrt{\frac{c_{\beta}(1 - c_{\beta})}{K}}$ |
| Width | $\frac{1}{K}\sum_{k=1}^K (B_k - A_k)$ | $\sqrt{\frac{1}{K(K-1)}\sum_{k=1}^K(W_k - \bar{W})^2}$ |

: Performance criteria for evaluating the ACE estimator. $\hat{\theta}_k$ denotes the ACE estimate from replication $k$ (for $k = 1, \ldots, K$), where $K = 1000$ is the number of replications, and $\theta$ denotes the true ACE for a given condition. For coverage and width criteria, $A_k$ and $B_k$ denote the lower and upper endpoints of the 95% confidence interval from replication $k$, $W_k = B_k - A_k$ is the interval width, $c_{\beta}$ is the estimated coverage probability, and $I(\cdot)$ is an indicator function equaling 1 if the condition is true and 0 otherwise. The Monte Carlo standard error (MCSE) quantifies the simulation uncertainty in each performance measure estimate

**Performance Criteria.** Table 1 presents the performance criteria used to evaluate the ACE estimator across simulation conditions. 

**Computational Details.** The simulation was conducted on a MacBook Pro (...), running macOS Sequoia 15.6.1 All analyses were performed in R [@] (version X). Parallel processing was implemented through the {doParalell} package (version X) [@doParallel], with {doRNG} (version X) [@doRNG] to ensure independent and reproducible random number streams. For data generation we used the {rvinecopulib} package (version X) [@rvinecopulib]. The estimator was implemented using the {marginaleffects} package (version X) [@marginaleffects]. Data wrangling was performed with {dplyr} (version X) [@dplyr]. Method performance was assessed through multiple metrics following the formulas from the {simhelpers} package (version X) [@simhelpers]. Figures were produced with {ggplot2} (version X) [@ggplot2] and {cowplot} (version X) [@cowplot]. Finally, this paper was written with apaquarto [@] (see GitHub repository for more information on reproducing the manuscript and analyses).