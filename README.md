# Nix and Rix tutorial

This repository contains all the materials for the article submitted to 
"AMPPS Call for Papers on Replicability and Reproducibility in Methodological 
Research".

## Repository Structure

```
Why-risk-it-when-you-can-rix-it/
├── Manuscript/                    # Main article and supporting documents
│   ├── article.qmd                # Primary manuscript (Quarto document)
│   ├── appendix_a.qmd             # Appendix A: Simulation study design details
│   ├── appendix_b.qmd             # Appendix B: Package dependencies documentation
│   ├── references.bib             # Bibliography file
│   ├── _quarto.yml                # Quarto project configuration
│   ├── _extensions/               # Quarto extensions
│   │   └── wjschne/apaquarto/     # APA 7th edition formatting extension
│   ├── article.tex                # Generated LaTeX intermediate file
│   ├── article.fff                # LaTeX float file (figures)
│   └── article.ttt                # LaTeX float file (tables)
│
├── docs/                          # Rendered output files (GitHub Pages source)
│   ├── index.html                 # HTML version (GitHub Pages entry point)
│   ├── article.pdf                # PDF version of the manuscript
│   ├── article_files/             # Supporting assets for HTML
│   │   ├── figure-html/           # HTML figure outputs
│   │   ├── figure-pdf/            # PDF figure outputs
│   │   └── libs/                  # JavaScript/CSS libraries
│   └── _extensions/               # Extension assets for HTML rendering
│       └── wjschne/apaquarto/     # APA CSS and icons
│
├── Simulation_Scripts/            # R scripts for the simulation study
│   ├── 01_data_generation.R       # Data generating process (DGP) functions
│   ├── 02_models.R                # Model estimation functions
│   ├── 03_run_simulation.R        # Main simulation loop
│   ├── 04_performance_metrics.R   # Performance metrics calculation
│   ├── 05_plots.R                 # Visualization code
│   └── 06_run_all.R               # Master script to run entire workflow
│
├── Proposal/                      # Original project proposal
│   ├── Proposal.qmd               # Proposal source document
│   ├── Proposal.pdf               # Rendered proposal (PDF)
│   ├── Proposal.html              # Rendered proposal (HTML)
│   └── references.bib             # Proposal bibliography
│
├── .github/
│   └── workflows/
│       └── render.yaml            # GitHub Actions CI/CD workflow
│
├── default.nix                    # Nix environment specification (generated)
├── gen-env.R                      # Script to generate default.nix using {rix}
├── .Rprofile                      # R profile for Nix environment isolation
├── LICENSE                        # MIT License
└── README.md                      # This file
```

## Key Components

### Manuscript (`Manuscript/`)

The main article is written in Quarto (`.qmd`) format and demonstrates full 
computational reproducibility. The manuscript:

- **`article.qmd`**: Contains the complete tutorial on using Nix and {rix} for 
reproducible simulation studies. The simulation code is embedded directly as 
executable chunks, allowing the entire manuscript to be reproduced from source.
- **`appendix_a.qmd`**: Provides detailed technical specifications of the 
simulation study design, including the data generating process, estimands, 
and performance criteria.
- **`appendix_b.qmd`**: Documents all R and LaTeX packages used, explaining why 
each dependency is required.
- **`_extensions/wjschne/apaquarto/`**: The apaquarto extension provides APA 
7th edition formatting for academic manuscripts.

### Simulation Scripts (`Simulation_Scripts/`)

The simulation study is organized into modular, sequential R scripts:

| Script | Purpose |
|--------|---------|
| `01_data_generation.R` | Defines the data generating process using {rvinecopulib} for copula-based data generation |
| `02_models.R` | Contains model estimation functions including the misspecified and correctly specified models |
| `03_run_simulation.R` | Executes the simulation across all factorial conditions with parallel processing |
| `04_performance_metrics.R` | Calculates performance metrics (bias, RMSE, coverage, CI width) using {simhelpers} |
| `05_plots.R` | Generates visualization of simulation results using {ggplot2} and {cowplot} |
| `06_run_all.R` | Master script that sources and runs the complete workflow sequentially |

### Nix Environment Configuration

The reproducible environment is defined through:

- **`gen-env.R`**: An R script that calls `rix::rix()` to generate the Nix 
environment specification. This defines all R packages, system packages 
(Quarto), LaTeX packages, and the R version.
- **`default.nix`**: The generated Nix expression that precisely specifies 
the computational environment. Pinned to a specific date (`2026-01-14`) to 
ensure temporal consistency.
- **`.Rprofile`**: Generated by `rix::rix_init()` to ensure R sessions 
within the Nix environment remain isolated from system packages and 
prevent accidental use of `install.packages()`.

### CI/CD (`.github/workflows/`)

The `render.yaml` workflow automatically:
1. Installs Nix using the Determinate Systems installer
2. Configures the binary cache for faster builds
3. Builds the Nix environment
4. Renders the manuscript using Quarto
5. Commits and pushes the rendered outputs to the repository

## Reproducing the Project

### Prerequisites

1. Install Nix following the instructions in the article or at:
   - Linux/Windows (WSL2): https://docs.ropensci.org/rix/articles/b1-setting-up-and-using-rix-on-linux-and-windows.html
   - macOS: https://docs.ropensci.org/rix/articles/b2-setting-up-and-using-rix-on-macos.html

### Building the Environment

```bash
# Clone the repository
git clone https://github.com/[username]/Why-risk-it-when-you-can-rix-it.git
cd Why-risk-it-when-you-can-rix-it

# Build the Nix environment
nix-build

# Enter the environment
nix-shell
```

### Reproducing the Manuscript

From within the Nix shell:

```bash
# Render the complete manuscript (runs all simulation code)
quarto render Manuscript/article.qmd
```

### Running the Simulation Independently

From within the Nix shell:

```bash
# Run the complete simulation workflow
Rscript Simulation_Scripts/06_run_all.R

# Or run individual scripts sequentially
Rscript Simulation_Scripts/03_run_simulation.R
Rscript Simulation_Scripts/04_performance_metrics.R
Rscript Simulation_Scripts/05_plots.R
```

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) 
file for details.

## Authors

- Felipe Fontana Vieira (Ghent University)
- Jason Geller (Boston College)
- Bruno Rodrigues (Ministry of Research and Higher Education, Luxembourg)
